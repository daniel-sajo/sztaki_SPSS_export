CREATE VIEW `view_for_spss_export` AS select `patient`.`name` AS `patientname`,`variable`.`name` AS `variablename`,floor(((to_days(`measurement`.`date`) - to_days(`patient`.`birthDate`)) / 7)) AS `week`,max(ifnull(`allowedvalue`.`value`,`datapoint`.`freevalue`)) AS `value` from (((`variable` join (`datapoint` left join `allowedvalue` on((`datapoint`.`valueid` = `allowedvalue`.`id`))) on((`variable`.`id` = `datapoint`.`variableid`))) join `measurement` on((`measurement`.`id` = `datapoint`.`measurementid`))) join `patient` on((`patient`.`id` = `measurement`.`patientid`))) group by `patient`.`name`,floor(((to_days(`measurement`.`date`) - to_days(`patient`.`birthDate`)) / 7)),`variable`.`name`;
